<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>WAR Simulator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 70px;
        }
        input, button {
            font-size: 18px;
            padding: 10px;
            margin: 5px;
        }
        button:disabled {
            background: gray;
            color: #ccc;
            cursor: not-allowed;
        }
        #countdown {
            font-size: 22px;
            margin-top: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>WAR TIKET SIMULATOR</h1>

    <div>
        <label>Jam Buka (HH:MM:SS)</label><br>
        <input id="timeInput" type="text" placeholder="17:44:00">
        <button id="setBtn">SET JAM WAR</button>
    </div>

    <p>Jam WAR: <b id="targetTime">-</b></p>
    <p id="countdown">Menunggu...</p>

    <button id="warBtn" disabled>BELI TIKET</button>

<script>
const timeInput   = document.getElementById("timeInput");
const setBtn      = document.getElementById("setBtn");
const warBtn      = document.getElementById("warBtn");
const targetLabel = document.getElementById("targetTime");
const countdown   = document.getElementById("countdown");

let targetDate = null;

/* ================= UTIL ================= */
function isValidTime(str) {
    return /^\d{2}:\d{2}:\d{2}$/.test(str);
}

/* ================= LOAD STATE ================= */
window.addEventListener("load", () => {
    const savedTime = localStorage.getItem("warTime");

    if (!savedTime) return;

    const [h, m, s] = savedTime.split(":").map(Number);
    targetDate = new Date();
    targetDate.setHours(h, m, s, 0);

    const now = new Date();
    if (targetDate <= now) {
        // â›” tombol baru aktif SETELAH refresh & waktu lewat
        warBtn.disabled = false;
        countdown.innerText = "WAR OPEN (SETELAH REFRESH)";
    } else {
        warBtn.disabled = true;
        targetLabel.innerText = savedTime;
        countdown.innerText = "Menunggu WAR...";
    }
});

/* ================= SET JAM ================= */
setBtn.addEventListener("click", () => {
    const val = timeInput.value.trim();

    if (!isValidTime(val)) {
        alert("Format harus HH:MM:SS");
        return;
    }

    const [h, m, s] = val.split(":").map(Number);

    const now = new Date();
    targetDate = new Date();
    targetDate.setHours(h, m, s, 0);

    if (targetDate <= now) {
        targetDate.setDate(targetDate.getDate() + 1);
    }

    localStorage.setItem("warTime", val);

    targetLabel.innerText = val;
    warBtn.disabled = true;
    countdown.innerText = "Countdown dimulai...";
});

/* ================= COUNTDOWN ================= */
setInterval(() => {
    if (!targetDate) return;

    const now = new Date();
    const diff = targetDate - now;

    if (diff <= 0) {
        // â›” jangan enable di sini
        countdown.innerText = "WAR OPEN! REFRESH PAGE ðŸ”„";
        return;
    }

    const ms = diff % 1000;
    const totalSec = Math.floor(diff / 1000);
    const s = totalSec % 60;
    const m = Math.floor(totalSec / 60) % 60;
    const h = Math.floor(totalSec / 3600);

    countdown.innerText =
        `H-${String(h).padStart(2,"0")}:` +
        `${String(m).padStart(2,"0")}:` +
        `${String(s).padStart(2,"0")}.` +
        `${String(ms).padStart(3,"0")}`;
}, 50);

/* ================= ACTION ================= */
warBtn.addEventListener("click", () => {
    window.location.href = "page2.html";
});
</script>

</body>
</html>
